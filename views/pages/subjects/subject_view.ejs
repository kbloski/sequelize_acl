<%- include('../partials/head', { title: 'School View'}) %>
<body>
    <%- include('../partials/navbar') %>
    <% const studentsWithGrade = subjectToView['Users'] %>

    <h3>School:</h3>
    <table class="table">
        <tr>
            <th>_id</th>
            <td><%= subjectToView.id %></td>
        </tr>
        <tr>
            <th>Name</th>
            <td><%= subjectToView.name %></td>
        </tr>
        <tr>
            <th>Description:</th>
            <td><%= subjectToView.description %></td>
        </tr>
        <tr>
            <th>Teacher</th>
            <td> 
                <%= htmlHelper.getElValueFromArrById(teachers, subjectToView.teacherId, 'name') %>
            </td>
        </tr>
        <tr>
            <th>School</th>
            <td> 
                <%= htmlHelper.getElValueFromArrById(schools, subjectToView.schoolId, 'name') %>
            </td>
        </tr>
    </table>
    <a href="/subjects/edit/<%= subjectToView.id %>">
        <button class="btn">Edit subject</button>
    </a>
    <!-- students list -->
    <p>
        <table class="table">
            <caption>Students</caption>
            <tr>
                <th>_id</th>
                <th>Name</th>
                <th>Surname</th>
                <th>School</th>
            </tr>
            <% if (students) { %> 
                <% for (const student of students){ %>
                    <tr>
                        <td> <%= student.id %> </td>
                        <td> <%= student.name %> </td>
                        <td> <%= student.surname %></td>
                        <td> <%= htmlHelper.getElValueFromArrById(schools, subjectToView.schoolId, 'name') %> </td>
                    </tr>
                <% } %>
            <%} %>
        </table>
        <a href="/subjects/add/student"><button class="btn">Add student to subject</button></a>
    </p>

    <!-- grades list -->
    <p>
        <% if (students){ %>
        <table class="table">
            <caption>All grades</caption>
            <tr>
                <th>_id</th>
                <th>Name</th>
                <th>Surname</th>
                <th>Role</th>
                <th>School</th>
                <th>Grade</th>
                <th>Actions</th>
            </tr>
            <% for (const student of studentsWithGrade) { %> 

                <% const grades = student['Grades'] %>
                <% for (const grade of grades) { %> 

                    <tr>
                        <td><%= student.id %></td>
                        <td><%= student.name %></td>
                        <td><%= student.surname %></td>
                        <td><%= student.role %></td>
                        <td><%= student['School']?.name %></td>
                        <td><%= grade.grade %></td>
                        <td>
                            <a href="/grades/view/<%= grade.id %>">View</a>
                        </td>
                    </tr>
                <% } %>
            <% } %>
        </table>
        <% } %>
    </p>

    <%- include('../partials/footer') %>

</body>